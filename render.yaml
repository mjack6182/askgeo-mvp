services:
  # Backend API Service
  - type: web
    name: ask-geo-backend
    runtime: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    plan: starter
    region: oregon
    envVars:
      - key: OPENAI_API_KEY
        sync: false  # Set this manually in Render dashboard
      - key: OPENAI_EMBED_MODEL
        value: text-embedding-3-small
      - key: OPENAI_CHAT_MODEL
        value: gpt-4o-mini
      - key: CHROMA_PATH
        value: /app/.chroma
      - key: INGEST_MAX_PAGES
        value: 600
      - key: BACKEND_PORT
        value: 8080
      - key: ALLOWED_ORIGINS
        value: "*"  # Will be updated after frontend URL is known
    healthCheckPath: /health
    disk:
      name: chroma-data
      mountPath: /app/.chroma
      sizeGB: 1

  # Frontend Service
  - type: web
    name: ask-geo-frontend
    runtime: docker
    dockerfilePath: ./frontend/Dockerfile.render
    dockerContext: ./frontend
    plan: starter
    region: oregon
    envVars:
      - key: BACKEND_URL
        fromService:
          type: web
          name: ask-geo-backend
          envVarKey: RENDER_EXTERNAL_URL
